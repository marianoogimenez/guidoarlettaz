---
const galleryItems = [
  {
    treatment: "Blanqueamiento Dental",
    desc: "Blanqueamiento LED profesional en una sesión.",
    tag: "Estética",
    beforeColor: "from-amber-200 to-yellow-100",
    afterColor: "from-teal-light to-emerald-200",
  },
  {
    treatment: "Carillas de Porcelana",
    desc: "Diseño de sonrisa completo con carillas.",
    tag: "Diseño de Sonrisa",
    beforeColor: "from-orange-200 to-amber-100",
    afterColor: "from-cyan-300 to-teal-200",
  },
  {
    treatment: "Implantes Dentales",
    desc: "Reemplazo de pieza con implante de titanio.",
    tag: "Implantología",
    beforeColor: "from-rose-200 to-pink-100",
    afterColor: "from-emerald-300 to-green-200",
  },
];

---

<section id="resultados" class="py-20 lg:py-28 bg-white overflow-hidden">
  <div class="max-w-7xl mx-auto px-4 sm:px-6">

    <!-- Section Header -->
    <div class="text-center max-w-2xl mx-auto mb-14 gallery-header" data-gallery-animate="header">
      <p class="text-teal-primary font-semibold text-sm uppercase tracking-wider mb-3">
        Resultados Reales
      </p>
      <h2 class="font-serif text-3xl sm:text-4xl lg:text-5xl font-bold text-slate-900 mb-4">
        Antes y Después
      </h2>
      <p class="text-slate-500 text-lg leading-relaxed">
        Casos reales de pacientes que transformaron su sonrisa en nuestro consultorio.
        Desliza para ver el cambio.
      </p>
    </div>

    <!-- Gallery Cards Grid -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {galleryItems.map((item, index) => (
        <div
          class="gallery-card group"
          data-gallery-animate="card"
          data-delay={index}
        >
          <div class="rounded-2xl overflow-hidden bg-white border border-slate-100 shadow-sm hover:shadow-xl hover:shadow-teal-primary/8 hover:-translate-y-1 transition-all duration-500">

            {/* Before / After Slider */}
            <div class="ba-slider relative aspect-[4/3] select-none overflow-hidden cursor-col-resize" data-ba-slider>

              {/* Before Layer (bottom) */}
              <div class="absolute inset-0">
                <div class={`w-full h-full bg-gradient-to-br ${item.beforeColor} flex items-center justify-center`}>
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-white/30 backdrop-blur-sm flex items-center justify-center">
                      <svg class="w-8 h-8 text-slate-500/70" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.182 15.182a4.5 4.5 0 01-6.364 0M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z" />
                      </svg>
                    </div>
                    <span class="text-slate-600/80 text-sm font-semibold uppercase tracking-widest">Antes</span>
                  </div>
                </div>
                {/* Before label badge */}
                <span class="absolute top-3 left-3 bg-slate-800/70 backdrop-blur-sm text-white text-xs font-semibold px-2.5 py-1 rounded-full">
                  Antes
                </span>
              </div>

              {/* After Layer (top, clipped) */}
              <div class="ba-after absolute inset-0" data-ba-after style="clip-path: inset(0 0 0 50%);">
                <div class={`w-full h-full bg-gradient-to-br ${item.afterColor} flex items-center justify-center`}>
                  <div class="text-center">
                    <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-white/40 backdrop-blur-sm flex items-center justify-center">
                      <svg class="w-8 h-8 text-teal-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.182 15.182a4.5 4.5 0 01-6.364 0M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z" />
                      </svg>
                    </div>
                    <span class="text-teal-dark text-sm font-semibold uppercase tracking-widest">Después</span>
                  </div>
                </div>
                {/* After label badge */}
                <span class="absolute top-3 right-3 bg-teal-primary/90 backdrop-blur-sm text-white text-xs font-semibold px-2.5 py-1 rounded-full">
                  Después
                </span>
              </div>

              {/* Slider Handle */}
              <div class="ba-handle absolute top-0 bottom-0 z-10 flex items-center" data-ba-handle style="left: 50%;">
                {/* Vertical line */}
                <div class="absolute top-0 bottom-0 w-0.5 bg-white shadow-lg" style="left: 50%; transform: translateX(-50%);"></div>
                {/* Circular handle */}
                <div class="relative w-10 h-10 -ml-5 rounded-full bg-white shadow-lg border-2 border-teal-primary flex items-center justify-center transition-transform duration-150 group-hover:scale-110 hover:scale-110">
                  <svg class="w-5 h-5 text-teal-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l-3 3 3 3m8-6l3 3-3 3" />
                  </svg>
                </div>
              </div>

              {/* Gradient overlay for depth */}
              <div class="absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-black/10 to-transparent pointer-events-none"></div>
            </div>

            {/* Card Content */}
            <div class="p-5 sm:p-6">
              <div class="flex items-start justify-between gap-3 mb-2">
                <div>
                  <span class="inline-block text-[11px] font-semibold uppercase tracking-wider text-teal-primary bg-mint px-2.5 py-0.5 rounded-full mb-2">
                    {item.tag}
                  </span>
                  <h3 class="text-lg font-bold text-slate-800 leading-tight">{item.treatment}</h3>
                </div>
                {/* Verified badge */}
                <div class="flex-shrink-0 flex items-center gap-1 bg-mint text-teal-primary text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded-full border border-teal-primary/20 whitespace-nowrap mt-1">
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                  <span>Caso real</span>
                </div>
              </div>
              <p class="text-slate-500 text-sm leading-relaxed">{item.desc}</p>
            </div>
          </div>
        </div>
      ))}
    </div>

    <!-- Disclaimer + CTA -->
    <div class="mt-12 text-center" data-gallery-animate="footer">
      <p class="text-slate-400 text-sm italic mb-6">
        * Imágenes con consentimiento del paciente. Los resultados pueden variar.
      </p>
      <a
        href="#contacto"
        data-nav-link
        class="inline-flex items-center gap-2.5 bg-teal-primary hover:bg-teal-dark text-white font-semibold px-8 py-3.5 rounded-full shadow-lg shadow-teal-primary/25 hover:shadow-xl hover:shadow-teal-primary/30 transition-all duration-300 hover:-translate-y-0.5"
      >
        Quiero resultados como estos
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </div>
</section>

<style>
  /* ---- Scroll-triggered entrance animations ---- */

  /* Initial hidden state for all animated elements */
  [data-gallery-animate] {
    opacity: 0;
    transform: translateY(32px);
  }

  /* Visible state triggered by JS */
  [data-gallery-animate].gallery-visible {
    animation: galleryFadeUp 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  }

  /* Staggered delays for cards */
  .gallery-card[data-delay="0"].gallery-visible {
    animation-delay: 0ms;
  }
  .gallery-card[data-delay="1"].gallery-visible {
    animation-delay: 150ms;
  }
  .gallery-card[data-delay="2"].gallery-visible {
    animation-delay: 300ms;
  }

  /* Footer delay */
  [data-gallery-animate="footer"].gallery-visible {
    animation-delay: 100ms;
  }

  @keyframes galleryFadeUp {
    from {
      opacity: 0;
      transform: translateY(32px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* ---- Before/After Slider styles ---- */

  .ba-slider {
    touch-action: none; /* prevent scroll while dragging on mobile */
  }

  .ba-handle {
    will-change: left;
  }

  .ba-after {
    will-change: clip-path;
  }

  /* subtle pulse on the handle to invite interaction */
  .ba-handle > div {
    animation: handlePulse 2.5s ease-in-out infinite;
  }

  .ba-slider:active .ba-handle > div,
  .ba-slider.is-dragging .ba-handle > div {
    animation: none;
    transform: scale(1.15);
    border-color: #0B7A70;
    box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.15), 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  @keyframes handlePulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(13, 148, 136, 0.2), 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(13, 148, 136, 0), 0 2px 8px rgba(0, 0, 0, 0.1);
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // ---- 1. Scroll-triggered animations with IntersectionObserver ----
    const animatedEls = document.querySelectorAll("[data-gallery-animate]");

    if (animatedEls.length > 0) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("gallery-visible");
              observer.unobserve(entry.target);
            }
          });
        },
        {
          threshold: 0.15,
          rootMargin: "0px 0px -40px 0px",
        }
      );

      animatedEls.forEach((el) => observer.observe(el));
    }

    // ---- 2. Before/After interactive slider ----
    const sliders = document.querySelectorAll("[data-ba-slider]");

    sliders.forEach((slider) => {
      const afterLayer = slider.querySelector("[data-ba-after]") as HTMLElement;
      const handle = slider.querySelector("[data-ba-handle]") as HTMLElement;
      if (!afterLayer || !handle) return;

      let isDragging = false;

      function getPosition(e: MouseEvent | TouchEvent): number {
        const rect = (slider as HTMLElement).getBoundingClientRect();
        let clientX: number;
        if ("touches" in e) {
          clientX = e.touches[0].clientX;
        } else {
          clientX = e.clientX;
        }
        let pct = ((clientX - rect.left) / rect.width) * 100;
        // Clamp between 5% and 95% so labels stay partially visible
        pct = Math.max(5, Math.min(95, pct));
        return pct;
      }

      function updateSlider(pct: number) {
        afterLayer.style.clipPath = `inset(0 0 0 ${pct}%)`;
        handle.style.left = `${pct}%`;
      }

      function onStart(e: MouseEvent | TouchEvent) {
        e.preventDefault();
        isDragging = true;
        (slider as HTMLElement).classList.add("is-dragging");
        const pct = getPosition(e);
        updateSlider(pct);
      }

      function onMove(e: MouseEvent | TouchEvent) {
        if (!isDragging) return;
        e.preventDefault();
        const pct = getPosition(e);
        updateSlider(pct);
      }

      function onEnd() {
        isDragging = false;
        (slider as HTMLElement).classList.remove("is-dragging");
      }

      // Mouse events
      slider.addEventListener("mousedown", onStart as EventListener);
      document.addEventListener("mousemove", onMove as EventListener);
      document.addEventListener("mouseup", onEnd);

      // Touch events
      slider.addEventListener("touchstart", onStart as EventListener, { passive: false });
      document.addEventListener("touchmove", onMove as EventListener, { passive: false });
      document.addEventListener("touchend", onEnd);
    });
  });
</script>
